<!-- Назначение файла: правила использования Codex. -->
# Инструкции для Codex

## Стиль
- Все комментарии и документацию пишите на русском языке.
- Код должен быть лаконичным и эффективным, избегайте избыточности.
- В начале каждого файла размещайте краткое описание его назначения и основных модулей.

## Тесты
В проекте пока нет автоматических тестов. После изменений достаточно убедиться, что проект собирается без ошибок. Дополнительно запускайте `npx eslint bot/src` для проверки кода.
## Проверка Docker Compose
Если присутствует `docker-compose.yml`, перед коммитом можно выполнить:
```bash
docker compose config
```
Эта команда проверит корректность файла.
Перед запуском убедитесь, что создан `.env`, иначе появится ошибка о его отсутствии.
При необходимости сформируйте `.env` из экспортированных переменных скриптом
`./scripts/create_env_from_exports.sh`. Скрипт создаёт файл только если его нет,
используя значения из текущего окружения либо данные из `.env.example`.

## Деплой
Перед развёртыванием убедитесь, что статический фронтенд собран командой
`npm --prefix bot run build-client` или через `Procfile`.
- Фронтенд теперь расположен в каталоге `bot/web`, Dockerfile и скрипты используют его вместо устаревшего `bot/client`.
- Перед сборкой установите зависимости фронтенда: `npm --prefix bot/web install`
- Если в логах встречается `GET /dashboard/` со статусом `404`, запустите `npm --prefix bot run build-client` и убедитесь, что каталог `bot/public` заполнен.
- При пустой директории `bot/public` сервер сам выполнит `npm run build-client`, однако после обновлений фронтенда сборку лучше запускать вручную.
- После обновления зависимостей повторяйте `npm --prefix bot/web install` и затем `npm --prefix bot run build-client`.
- Для сборки Tailwind используйте плагин `@tailwindcss/postcss` в файле `postcss.config.js`.
- Для форматирования кода фронтенда запустите `npm --prefix bot/web run format`.
  - Для поиска ошибок сохраняйте вывод в лог:
  ```bash
  npm --prefix bot/web install > /tmp/npm_install.log 2>&1 && tail -n 20 /tmp/npm_install.log
  npm --prefix bot run build-client > /tmp/npm_build.log 2>&1 && tail -n 20 /tmp/npm_build.log
  # или используйте ./scripts/build_client.sh
  ```
  Перед запуском `docker compose build` убедитесь, что запущен Docker daemon,
  иначе появится сообщение `Cannot connect to the Docker daemon`.

## Документация
- При добавлении функционала обновляйте раздел «В разработке» в `ROADMAP.md`.
- Создавайте задачи через шаблоны в `.github/ISSUE_TEMPLATE` и придерживайтесь `CONTRIBUTING.md`.
- Поддерживайте раздел «Обзор текущего состояния» в `README.md`, фиксируя основные плюсы и недостатки проекта.
- При добавлении маршрутов используйте `helmet`, `cors` и валидацию через `express-validator`.
- Страница `/dashboard/tasks` должна получать данные из MongoDB через API.
- На этой странице должна быть форма создания новой задачи.
- При успешном создании задачи отображайте `NotificationBar` со статусом `success`.
- Используйте файл `docs/telegram_bot_manual.md` как руководство по настройке команд и вебхуков Telegram-бота.
- Для компонентов страницы `tasks` используйте путь `../../_components/Section/*`.
- Новая страница `/dashboard/charts` демонстрирует работу `ChartLineSample`.
- После переноса фронтенда на React проверяйте работоспособность `/dashboard`.

Перед созданием PR проверяйте успешное развёртывание на https://railway.app.



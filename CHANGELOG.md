<!-- Назначение файла: список основных изменений. -->

# История изменений

## [Новый]
- Уточнён владелец репозитория и email в SECURITY.md и CODEOWNERS
- В `setup_and_test.sh` тесты запускаются с флагом `--detectOpenHandles`
- Добавлен скрипт `audit_deps.sh` и шаг CI для проверки зависимостей
- Клиент переведён на React 18 ради совместимости с TelegramUI
- Поддержан запуск в браузере через флаг `?browser=1`, telegram-apps-sdk не загружается
- Кнопка «Браузер» ведёт на `https://agromarket.up.railway.app/?browser=1`
- Клиент автоматически выбирает режим браузера при отсутствии `Telegram.WebApp`
- Завершение таймеров в `messageQueue` устранено
- Исправлен запрос обновления отдела: используется `$set`
- Код бота и клиента объединён в каталоге `bot`
- Приоритет по умолчанию исправлен на форму «В течение дня»
- Добавлены скрипты `setup_and_test.sh`, `create_env_from_exports.sh`, `create_admin_user.js` и `check_bot_token.sh`
- MongoDB запускается с учётными данными `admin`/`admin` и healthcheck на `mongosh`
- Бот работает через polling, меню и сообщения синхронизируются скриптами
- Авторизация через одноразовый код; количество попыток ограничено
- Формы задач вынесены в общий модуль `taskFields.cjs`
- Добавлены глобальные обработчики ошибок и дополнительные тесты
- Команда `/whoami` показывает ID и статус пользователя
- Добавлена пагинация списка задач через параметры `page` и `limit`
- В модели задач появилось поле `slug`, генерируемое из названия
- Добавлены `robots.txt`, мета‑описание и aria‑метки для кнопок
- Модель задач расширена логистикой, закупками и работами
- Добавлены поля `transport_type`, `payment_method`, `priority`, `status`
- Веб-клиент получил редактор React Quill и поддержку TelegramUI
  через библиотеку @telegram-apps/sdk-react
- CRUD-маршруты `/api/v1/tasks` поддерживают полный набор полей
- Форма задач и контроллеры поддерживают поля `transport_type`,
  `payment_method` и выбор статуса
- Добавлены коллекции `DefaultValue` и `Transport` для справочников
- API `/api/v1/defaults/:name` и `/api/v1/transports` позволяет редактировать значения
- Для этих маршрутов добавлен rate limit и проверка входных данных
- Формы задач открываются поверх текущей страницы через параметры URL
- Сайдбар можно полностью скрыть и раскрыть
- Макет формы адаптирован под мобильные устройства
- Добавлена возможность редактировать отделы через `/api/v1/departments` и страницу `/defaults`
- Улучшена безопасность обновления отделов: имя проходит проверку типа
- Интерфейс задач дополнен новой формой
- pm2 переведён в fork-режим, чтобы исключить конфликт polling
- Добавлены новые значения enum: "Построить", "Починить" для `task_type` и "Без оплаты" для `payment_method`
- Уточнён список допустимых `task_type` в документации
- Добавлена единая форма для создания и редактирования задач
- Название задачи теперь включает идентификатор вида `ERM_000001`
- API переведён на префикс `/api/v1`
- Изменён путь подключения к MongoDB на `ermdb`
- В формах задач отображается `request_id` и дата создания
- Поле "Ответственный" исключено, "Контролёр" поддерживает выбор нескольких
- Поля формы расположены в порядке: статус, приоритет, отдел и далее
- Кнопки "Карта" открывают карту в iframe с центром в Одессе
- "Исполнител(и)ь" и "Контролёр" можно выбирать из списка по кнопке «+»
- Бот разворачивает короткие ссылки Google Maps и показывает координаты
- В форме задачи при вставке ссылки поле скрывается, отображается адрес
- Добавлены поля `startCoordinates` и `finishCoordinates`
- Координаты точки теперь выводятся под ссылкой в форме
- Автоподстановка финальной точки из стартовой отключена
- Выпадающие списки упоминаний удалены

### Безопасность
- В режиме разработки в консоль выводится только начало `BOT_TOKEN`


- Исправлены пути API в клиенте: добавлен префикс /api/v1
- Удалены неиспользуемые состояния `roles` и `groups` в компоненте `TaskDialog`
- Провайдер `ThemeProvider` корректно экспортируется из файла `ThemeContext.tsx`
- Провайдеры `SidebarProvider` и `ToastProvider` экспортируются из файлов контекста

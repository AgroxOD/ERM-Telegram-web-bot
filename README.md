<!-- Назначение файла: документация проекта и общие инструкции. -->
# Telegram Task Manager Bot + AdminJS

Файл описывает проект и способы его развертывания.

Каталог `bot` содержит код бота, `admin` — интерфейс AdminJS.
Оба каталога включают собственные `Dockerfile` для сборки образов.

Дополнительная информация о плане разработки представлена в файле `ROADMAP.md`, а история изменений ведется в `CHANGELOG.md`.

## Быстрый старт

### Требования
- Docker и Docker Compose
- Учётная запись MongoDB Atlas

### Локальный запуск
1. Склонируйте текущий репозиторий с модифицированным кодом:
   ```bash
   git clone https://github.com/AgroxOD/agrmcs.git
   ```
   Каталоги `bot` и `admin` уже содержат необходимые исходники.
2. Перед запуском создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```
   Далее заполните переменные, например `MONGO_DATABASE_URL`.
3. В переменную `CHAT_ID` запишите ID чата для уведомлений. Его можно узнать через бота `@userinfobot`.
4. Запустите контейнеры:
   ```bash
   docker-compose up --build
   ```
   Compose соберёт образы из `bot/Dockerfile` и `admin/Dockerfile`, запустит контейнер MongoDB.
   Фронтенд AdminJS компилируется в процессе сборки образа.
   Бот будет работать в Telegram, а интерфейс AdminJS откроется на `http://localhost:3000/admin`.

При необходимости можно собрать единый образ из корневого `Dockerfile`:
```bash
docker build -t task-manager .
docker run --env-file .env -p 3000:3000 task-manager
```

### Развёртывание на [Pella](https://www.pella.app)
1. Подключите репозиторий к сервису и выберите проект.
2. Для каждого контейнера задайте рабочую директорию `bot` или `admin`.
3. Укажите версию Node `18` и переменные окружения из `.env.example`.
4. Бот запускается из `src/bot/bot.js` командой:
   ```bash
   npm start
   ```
   Панель использует `dist/index.js`, запуск через:
   ```bash
   yarn start
   ```
5. Запустите сборку и дождитесь успешного деплоя.

### Подробная инструкция для Pella
1. На панели управления создайте новое приложение и свяжите его с репозиторием.
2. Добавьте два процесса:
   - **bot**: рабочая директория `bot`, основной файл `src/bot/bot.js`, команда сборки `npm install`, запуск `npm start`.
   - **admin**: рабочая директория `admin`, главный файл `dist/index.js`, команда сборки `yarn install --production && yarn build`, команда запуска `yarn start`.
3. Перенесите значения из `.env.example` в раздел переменных окружения.
4. Сохраните настройки и запустите деплой. Через пару минут сервисы станут доступны.

## Структура проекта
```
project-root/
├── ROADMAP.md          # план разработки
├── CHANGELOG.md        # история версий
├── bot/                # исходный код Telegram-бота
│   └── Dockerfile      # контейнер бота
├── admin/              # приложение AdminJS
│   └── Dockerfile      # контейнер панели
├── .env.example        # пример переменных
├── .env                # локальные переменные (не добавляйте в git)
├── docker-compose.yml  # локальное развертывание
└── README.md           # документация
```

## Лицензия
Проект распространяется под лицензией MIT.

## CI с Docker
Файл `.github/workflows/docker.yml` проверяет `docker-compose.yml` и собирает образы при каждом pull request.

## Безопасность
Файл `.env` содержит секреты и предназначен только для локальной разработки.
Создайте его на основе `.env.example` и не публикуйте в репозитории.
Для продакшена рекомендуем использовать Docker Secrets или сторонние хранилища
секретов, например [Vault](https://www.vaultproject.io/).

<!-- Назначение файла: план развития проекта. -->
# Дорожная карта проекта


Каталог `bot` содержит логику Telegram-бота и мини‑приложение,
отвечающее за приём задач и их обработку.
Каталог `admin` удалён, весь функционал реализован в мини‑приложении.

Ниже описан общий план развития этих модулей.

## 1. Подготовительный этап
- Клонирование репозитория.
- Создание файла `.env` и настройка переменных.
- Автоматизация генерации `.env` скриптом `create_env_from_exports.sh`, который
  берёт значения из текущего окружения и заполняет отсутствующие дефолтами из
  `.env.example`.

## 2. Интеграция
- Настройка общего Dockerfile и Compose для запуска обоих сервисов.
- Проверка локального запуска, устранение ошибок сборки.
- При возникновении ошибки `lstat /client` убедитесь, что Docker собирает
  образ из каталога `bot` и в нём присутствует папка `client`.
- Переход на MongoDB Atlas для хранения данных.
- Интеграция с облачным хранилищем R2.

- Добавление нового функционала бота и мини‑приложения.
- Тестирование и оптимизация.

- Использование платформы [Railway](https://railway.app) для публикации сервисов.
- Конфигурация CI/CD (например, GitHub Actions).
- Добавить сборку фронтенда в Procfile, чтобы исключить ошибку 404 при деплое.
- Проверять наличие каталога `bot/public` после сборки для устранения ошибки 404 на `/dashboard`.
- При пустой директории `bot/public` API теперь запускает `npm run build-client` автоматически.
- При использовании Railway отслеживать логи на наличие 404 и в случае ошибки повторять `npm --prefix bot run build-client`.
- Если в логе сервиса виден запрос `GET /dashboard/` со статусом 404, это признак отсутствия статических файлов; выполните сборку повторно.
- После обновления зависимостей перед каждой сборкой интерфейса выполняйте `npm --prefix bot/web install`.
- В `bot/web/next.config.ts` включите `trailingSlash`, чтобы страницы вроде `/dashboard` работали после обновления.
- Для диагностики сохраняйте вывод сборки:
  ```bash
  npm --prefix bot/web install > /tmp/npm_install.log 2>&1 && tail -n 20 /tmp/npm_install.log
  npm --prefix bot run build-client > /tmp/npm_build.log 2>&1 && tail -n 20 /tmp/npm_build.log
  # или ./scripts/build_client.sh
  ```

## В разработке
- Перенос фронтенда на React + Vite + Tailwind завершён.
- Настроены Jest и Supertest, добавлена интеграция Husky с `eslint` и тестами.
- Подключён Swagger для генерации документации API.
- Запущен CI на GitHub Actions с проверкой линтера и тестов.
- Добавлены скрипты миграций и сидов MongoDB.
- Создана простая админ‑панель управления пользователями и логами.
- Расширена валидация API и добавлены разделы "Логи" и "Роли" во фронтенде.
- Базовая конфигурация ESLint размещена в `eslint.config.js`, команды `npx eslint bot/src` проверяют серверный код.
- В API добавлены `helmet`, `cors` и проверка полей через `express-validator`.
- Для PostCSS в React‑фронтенде используется плагин `@tailwindcss/postcss`.
- Во фронтенд добавлен Prettier и градиентный фон из шаблона React Vite Tailwind.
- В интерфейс интегрирован пример дизайна TailAdmin: страницы повторяют стили оригинала, добавлена страница Charts и компонент NotificationBar.
- Настраиваем автоматический деплой на Railway через GitHub Actions.
- Добавлен скрипт `scripts/audit_dependencies.sh` для `npm audit` и `npm outdated`.
- Расширяем документацию по сценарию использования API.
- Настроен workflow `release.yml` для автоматических GitHub Releases.
- Добавлен шаблон pull request и файл CODEOWNERS.
- Интегрируем дополнительные возможности Telegram Bot API через `telegramApi.js`.
- Описаны лучшие практики CI/CD в разделе README.
- Во фронтенд добавлены компоненты Sidebar, Header и DashboardPage из TailAdmin на TypeScript.
- Настроен TypeScript в каталоге `bot/web` и подключён tsconfig.
- Интерфейс полностью адаптирован к дизайну TailAdmin с использованием `@heroicons/react`.




## 5. Отслеживание версий
- Для каждой версии фиксировать изменения в файле `CHANGELOG.md`.
- Помечать релизы git-тегами вида `vX.Y.Z`.

## 6. Документация и безопасность
- После релиза обновлять `README.md` и `SECURITY.md`.
- Проверять конфигурацию `docker-compose.yml` командой `docker compose config`.
- Перед этим убедитесь, что создан файл `.env`, иначе проверка завершится ошибкой.

## 7. Поддержка зависимостей
- Периодически выполнять `npm audit` и `npm outdated` для модуля `bot`.
- Обновлять пакеты после успешного прохождения тестов.
- Использовать скрипт `scripts/audit_dependencies.sh` для автоматизации проверки.
- При возникновении ошибок сети при обращении к `nextjs.org` убедитесь в наличии интернет‑доступа или настройте прокси.
- Если `npm` выводит предупреждение `Unknown env config "http-proxy"`, его можно игнорировать либо удалить переменные `http_proxy` и `https_proxy` из окружения.

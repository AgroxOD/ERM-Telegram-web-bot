<!-- Назначение файла: краткий план развития проекта. -->

# Дорожная карта проекта

1. Подготовка окружения: `.env` из `.env.example`, запуск Docker Compose
2. Развитие бота и мини‑приложения в каталоге `bot`
3. Исправлена сборка CSS для стабильного дизайна
4. Автоматические тесты через `./scripts/setup_and_test.sh` локально и в CI; при наличии Docker проверяется `docker compose config`, иначе выводится предупреждение
5. Аудит зависимостей командой `./scripts/audit_deps.sh`
6. Слабые уязвимости пропускаются флагом `--audit-level high`
7. Скрипт `install_bot_deps.sh` завершает установку,
   если остаются только нерешённые слабые уязвимости
8. Проверка MongoDB скриптом `check_mongo.cjs`, использование healthcheck в Docker
9. Поддержка pm2 6.0.8 и повторных подключений к базе
10. Настройка fork-режима pm2 для предотвращения ошибок polling
11. Синхронизация команд и сообщений скриптами при деплое
12. Расширение API и интерфейса по мере необходимости
13. Пагинация списка задач для уменьшения нагрузки на клиент
14. Автоматическое формирование `slug` для человекочитаемого URL
15. Улучшение SEO и доступности (robots.txt, aria‑label, meta description)
16. Расширенная модель задачи с логистикой, закупками и работами
17. Поддержка enum-полей для типов транспорта, оплаты и статусов
16. CRUD-эндпойнты `/api/v1/tasks` с полной формой заявки
17. Учёт этих полей в веб-клиенте и контроллерах
17. Значения enum задаются в `taskFields.cjs`, страница справочников удалена
18. Редактирование отделов через `/api/v1/departments`, имена проходят проверку типа
19. Обновление отделов выполняется через `$set`, чтобы избежать лишних условий
20. Улучшение интерфейса управления заявками
21. Расширение enum-значений: добавлены "Построить", "Починить" и "Без оплаты"
22. Уточнение документации о допустимых значениях `task_type`
23. Унификация формы создания и редактирования задач
24. Везде использовать идентификатор вида `ERM_000001` и добавлять его к названию
25. Форма задач: сначала дата начала и срок выполнения, затем статус и приоритет, контролёр допускает несколько значений
26. Кнопки "Карта" ведут на ссылку <https://maps.app.goo.gl/xsiC9fHdunCcifQF6> без iframe
27. Бот отвечает полной ссылкой и координатами на короткие URL Google Maps
29. Форма задач принимает короткие ссылки Google Maps и сохраняет полные
30. Исполнители и контролёр добавляются из выпадающего списка через кнопку «+»
31. Поле ввода ссылки на карту скрывается после вставки, показывается адрес
32. Координаты сохраняются в `startCoordinates` и `finishCoordinates`
33. В форме под ссылкой отображаются координаты
34. Пустые координаты не передаются в API
34. Добавить поле `start_date` для даты начала задачи
34. Форма выравнивается слева и растягивается на всю ширину
35. Выпадающие списки упоминаний удалены
36. Унифицирован префикс /api/v1 во всех запросах клиента
36. Интеграция React Quill и TelegramUI через @telegram-apps/sdk-react
37. Запуск мини-приложения в браузере по флагу `?browser=1`; кнопка «Браузер» ведёт на `https://agromarket.up.railway.app/?browser=1`
38. Клиент автоматически выбирает режим работы при отсутствии `Telegram.WebApp`
39. Удалить неиспользуемые состояния `roles` и `groups` в `TaskDialog`
40. Вынести React-контексты в отдельные файлы для поддержки hot reload
41. В логах разработки выводить только начало `BOT_TOKEN`
42. Указать рабочий email в SECURITY.md и владельца в CODEOWNERS
43. Обновить документацию: приоритет по умолчанию — «В течение дня»
44. Экспортировать провайдеры контекстов из файлов контекста для надёжного импорта
45. Открывать форму задачи поверх текущей страницы по параметрам URL
46. Добавить возможность скрывать сайдбар на всех устройствах
47. Уточнить стили формы для мобильных экранов
48. Шапка учитывает ширину сайдбара и растягивается при его скрытии
49. Форма задач заполняет область под шапкой и центрируется
50. Отправка формы авторизации клавишей Enter
51. Поле "Название" находится в начале формы задачи
52. Некоторые поля формы размещены на одной строке для уменьшения высоты
52. Все ответы бота собраны в `docs/bot_responses.md` и представлены на русском
53. Скрипт `scripts/db/seed.js` использует приоритет «Срочно» для тестовой задачи
54. Списки значений загружаются из `taskFields.cjs` без вызова API
55. Страница `/tasks` показывает даты начала и завершения,
    админ может менять статус и приоритет прямо в таблице,
    доступна сортировка по всем колонкам
56. Эндпойнт `/api/v1/route` возвращает координаты и длину маршрута
57. Инструкция по запуску ORSM на Railway в docs/orsm.md
58. Пример переменной `ROUTING_URL` использует сервис `https://orsm-production.up.railway.app/route`
59. Фронтенд использует переменную `VITE_ROUTING_URL` с тем же адресом
60. README содержит пример JSON с координатами
61. В мануале к боту описано разворачивание коротких ссылок Google Maps
62. Документ `docs/railway_full_setup.md` описывает развёртывание всего проекта на Railway
63. В задачи добавлено поле `route_distance_km` для расстояния маршрута
64. Ссылка маршрута сохраняется в поле `google_route_url`
65. Новый API `/api/v1/routes/all` и страница «Маршруты» с картой
66. Параметр `status` в этом API проверяется как строка и передаётся в запрос без операторов
67. Leaflet подключён локально, политика CSP разрешает тайлы OpenStreetMap
68. Статусы задач расширены значением `canceled`, время выполнения сохраняется в `completed_at`
68. Политика CSP разрешает подключение к сервису ORSM
    и домену `router.project-osrm.org`
69. Фильтры маршрутов отправляются только при заполнении
70. Страница `/tasks` автоматически обновляет список после создания задачи,
    добавлена кнопка «Обновить задачи»
71. Страница маршрутов строит путь через OSRM,
    задачи задают порядок отображения маршрутов
72. Карта занимает верхнюю часть страницы, таблица задач закреплена снизу
73. Старт и финиш маршрута отмечены интерактивными иконками,
    фильтры статуса и отдела удалены, задачи выводятся таблицей,
    администратор может открывать их на редактирование
74. Форма задачи всегда поверх карты, окно можно свернуть или развернуть,
    администратор может удалить задачу с подтверждением
75. При открытии задачи ввод блокируется, для изменений есть кнопка «Редактировать»
76. В Tailwind настроены палитры `success`, `error` и `warning` для оформления кнопок и уведомлений
77. Реализована оптимизация маршрутов для 1–3 машин, на странице «Маршруты» добавлена кнопка «Просчёт маршрута»
78. Маршруты отображаются поверх карты разными цветами, есть кнопка «Сбросить»
79. Меню расчёта находится между картой и списком задач
80. Ссылки Google Maps показываются в меню и не открываются автоматически
81. Если выбрано несколько машин, задачи распределяются между всеми авто
82. Удалённые задачи переносятся в коллекцию `archives` с номером вида `ERM_xxx-DEL`
83. Страница `/tasks` позволяет скачать таблицу задач в CSV или JSON
84. Кнопки действий задачи вынесены под форму и становятся зелёными при выборе
85. Команда `/task_form_app` отправляет ссылку на форму создания задачи
86. Все изменения задач фиксируются в коллекции логов
87. Исправлена ошибка линтера в `TaskDialog`: состояние `selectedAction` подсвечивает выбранную кнопку




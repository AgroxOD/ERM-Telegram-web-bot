<!-- Назначение файла: краткий план развития проекта. -->

# Дорожная карта проекта

1. Настройка окружения: создание `.env` из `.env.example` и запуск Docker Compose.
2. Доработка бота и мини‑приложения в каталоге `bot`.
3. Автоматические тесты и линтинг перед каждым релизом.
4. Публикация образов и деплой на Railway.
5. Расширение API и интерфейса по мере необходимости.
6. Синхронизация `.env.example` с актуальными параметрами.
7. Локальный контейнер MongoDB запускается по умолчанию, к Railway подключаемся только при деплое.
8. В Docker Compose MongoDB запускается с учётными данными `admin`/`admin`; для
   Railway используем реальные логин и пароль.
9. Документация по GitHub Actions с отдельным MongoDB-хостом или Railway CLI.
10. Инструкция по проверке подключения к MongoDB скриптом `scripts/check_mongo.cjs`.
11. Скрипт `setup_and_test.sh` для автоматической установки зависимостей и проверки проекта.
12. Использование `setup_and_test.sh` в CI для единообразных проверок.
13. Улучшение `check_mongo.cjs` для работы с `authSource=admin`.
14. Документация о переменной `BOT_API_URL` и запуске локального telegram-bot-api.
15. Скрипт `create_env_from_exports.sh` выводит переменные с экранированием для поддержки спецсимволов.

16. Краткий абзац о роли `BOT_API_URL` в README для пояснения локального API.
17. Добавить `healthcheck` для MongoDB в `docker-compose.yml`, чтобы бот ждал готовности базы.
18. В `healthcheck` использовать `mongosh -u admin -p admin --authenticationDatabase admin --eval 'db.adminCommand("ping")'`.
19. Удалить устаревшие отчёты Lighthouse и кратко переписать `extended_tailadmin_guide.md`.
20. В workflow `docker.yml` запускать локальный контейнер MongoDB для проверки
    соединения перед сборкой образов.
21. Создать скрипт `create_admin_user.js` для выдачи прав администратора по Telegram ID.
22. Переписать `create_admin_user.js` на CommonJS, добавить поиск `mongoose` в каталоге `bot` и обработку ошибок подключения.
23. README уточняет необходимость запуска `npm ci --prefix bot` перед выполнением `create_admin_user.js` и приводит пример команды `NODE_PATH=./bot/node_modules node scripts/create_admin_user.js <id> [username]`.
24. Верификация через Telegram Login заменена кодом подтверждения и страницей CodeLogin.
25. Документация дополнена описанием проверки участника чата перед выдачей ссылки на мини‑приложение.
26. Добавить авторизацию по `username` с инструкцией об использовании @userinfobot и скрывать интерфейс до входа.
27. Убрать авторизацию по `username`; вход доступен только по коду подтверждения.
28. Использовать `pm2` для мониторинга и перезапуска сервисов.
29. Обновить `pm2` до версии 6.0.8 и скорректировать установочные скрипты.
30. Перевести сообщения о запуске сервисов на русский язык.
31. Расположить маршрут `/tasks/mentioned` в `routes/tasks.js` перед параметрическим `/:id`, чтобы избежать ошибок приведения ObjectId.
32. Добавить перезапуск контейнера MongoDB в Docker Compose и внедрить повторные попытки подключения.
33. Перехват ошибки `request.aborted` и ответ 400 в API


34. Удалить устаревший метод telegramLogin и связанные проверки.
35. Добавить глобальные обработчики ошибок и настроить pm2 (max_restarts, min_uptime).
36. Исправить запуск pm2-runtime через npx --prefix bot и добавить тест errorHandler.
37. Улучшить проверку JWT, разрешив только алгоритм HS256.
38. Удалить контроллер `reportController` и его тест как неиспользуемые.
39. Ограничить число попыток ввода кода подтверждения и очищать имена файлов перед загрузкой в R2.
40. Дополнить сообщения о запуске сервисов сведениями об окружении и версии Node для Railway.
41. Реализовать команду `/whoami` и модуль `userInfoService` для вывода ID и статуса участника.
42. При неудачной установке вебхука автоматически переключаться на polling
    и уведомлять администратора сообщением с текстом ошибки.
43. Создать скрипт `check_bot_token.sh` и рекомендовать его запуск перед деплоем.
44. Синхронизировать файлы `bot_commands.json` и `bot_messages.json` и
    описать скрипт `set_attachment_menu_url.js` в документации.
45. Завершать процесс при ошибке `bot.launch`, обернув вызов в `try/catch`.
46. Автоматически запускать `set_bot_commands.sh` из Procfile при деплое на Railway.


<!-- Мини-приложение Telegram для управления задачами. Использует API бота. -->
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Task Mini App</title>
</head>
<body>
<h3>Задачи</h3>
<ul id="tasks"></ul>
<input id="newTask" placeholder="Новая задача"/>
<button onclick="addTask()">Создать</button>
<button id="adminBtn">Админ-панель</button>
<div id="adminFrame" style="display:none;height:600px">
  <iframe src="/admin" style="width:100%;height:100%"></iframe>
</div>
<script>
const params = new URLSearchParams(location.search);
const token = params.get('token') || '';
if (params.get('admin') === '1') document.getElementById('adminFrame').style.display = 'block';
async function loadTasks() {
  const r = await fetch('/tasks', { headers: { Authorization: token } });
  document.getElementById('tasks').innerHTML = (await r.json()).map(t => `<li>${t.task_description} — ${t.status}</li>`).join('');
}
async function addTask() {
  const description = document.getElementById('newTask').value;
  await fetch('/tasks', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: token }, body: JSON.stringify({ description }) });
  loadTasks();
}
loadTasks();
document.getElementById('adminBtn').onclick = () => {
  document.getElementById('adminFrame').style.display = 'block';
};
</script>
</body>
</html>

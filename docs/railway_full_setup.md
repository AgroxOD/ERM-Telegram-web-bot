<!-- Назначение файла: пошаговая инструкция по развертыванию всего проекта на Railway. -->

# Полный запуск проекта на Railway

Ниже описаны шаги по настройке сервиса на Railway так, чтобы бот, веб‑клиент и API работали вместе с GraphHopper.

## 1. Создание проекта
1. Зарегистрируйтесь на Railway и создайте новый проект.
2. Добавьте плагин **MongoDB**. После создания Railway выдаст переменную `DATABASE_URL`.

## 2. Развёртывание основного приложения
1. Нажмите **New Service → Deploy from GitHub** и выберите этот репозиторий.
2. В разделе **Variables** задайте:
   - `BOT_TOKEN` — токен от BotFather.
   - `MONGO_DATABASE_URL` — значение из `DATABASE_URL` плагина MongoDB.
   - `APP_URL` — домен проекта вида `https://<имя>.up.railway.app`.
   - `ROUTING_URL` — адрес сервиса маршрутов из следующего шага.
3. Railway автоматически использует `Procfile`, который собирает клиент и запускает pm2.

## 3. Добавление GraphHopper
1. Создайте ещё один сервис с типом **Deploy from Docker**.
2. Укажите образ `israelhikingmap/graphhopper`.
3. Вместо готового образа можно собрать свой из каталога `graphhopper-docker` этого репозитория.
4. В поле `Start Command` задайте:
   ```bash
   graphhopper --url https://download.geofabrik.de/europe/andorra-latest.osm.pbf --host 0.0.0.0
   ```
5. Добавьте переменную `JAVA_OPTS` например `-Xms1g -Xmx2g`.
6. После загрузки карты сервис станет доступен по `https://<имя_сервиса>.up.railway.app`.
7. Укажите этот URL в переменной `ROUTING_URL` основного приложения.

## 4. Запуск и проверка
1. Нажмите **Deploy** для обоих сервисов.
2. Откройте адрес из переменной `APP_URL` и убедитесь, что мини‑приложение загружается.
3. В Telegram отправьте `/start` боту и создайте тестовую задачу.
4. Эндпойнт `/api/v1/route` должен возвращать маршрут с использованием GraphHopper.

## 5. Дополнительные рекомендации
- Используйте Railway CLI для локальных тестов (`railway up`).
- При обновлении репозитория Railway автоматически перезапустит сервис.

